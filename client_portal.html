<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Portal - Inner Compass Parenting</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary-color: #6597b8;
            --secondary-color: #749494;
            --text-color: #556570;
            --light-bg: #f8f9fa;
            --soft-grey: #f1f2f4;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.7;
            color: var(--text-color);
            background-color: var(--soft-grey);
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-size: 1.2rem;
            color: var(--text-color);
        }
        
        .login-form {
            max-width: 400px;
            margin: 10vh auto;
            padding: 2rem;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
            border: 1px solid var(--secondary-color);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-color);
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .form-button {
            width: 100%;
            padding: 0.75rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .form-button:hover {
            background: var(--text-color);
        }
        
        .error-message {
            background: var(--light-bg);
            border: 1px solid var(--primary-color);
            color: var(--text-color);
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .hidden {
            display: none;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: var(--soft-grey);
            padding: 0rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            margin-left: -5px;
        }

        .logo img {
            height: 65px;
            width: auto;
        }

        .nav-links {
            list-style: none;
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--text-color);
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: var(--primary-color);
        }

        .logout-btn {
            background: var(--secondary-color);
            color: white;
            padding: 0.5rem 1.25rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: var(--text-color);
        }

        /* Mobile Menu */
        .mobile-menu-btn {
            display: none;
            flex-direction: column;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
        }

        .hamburger-line {
            width: 25px;
            height: 3px;
            background: var(--text-color);
            margin: 3px 0;
            transition: 0.3s;
            border-radius: 2px;
        }

        .mobile-nav {
            display: none;
            position: fixed;
            top: 65px;
            left: 0;
            width: 100%;
            background: var(--soft-grey);
            border-bottom: 1px solid var(--border-color);
            z-index: 99;
        }

        .mobile-nav.active {
            display: block;
        }

        .mobile-nav-links {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .mobile-nav-links li {
            border-bottom: 1px solid var(--border-color);
        }

        .mobile-nav-links li:last-child {
            border-bottom: none;
        }

        .mobile-nav-links a {
            display: block;
            padding: 1rem 2rem;
            text-decoration: none;
            color: var(--text-color);
            font-weight: 500;
            transition: background 0.3s ease;
        }

        .mobile-nav-links a:hover {
            background: rgba(101, 151, 184, 0.1);
            color: var(--primary-color);
        }

        /* Welcome Section */
        .welcome-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
            border: 1px solid var(--secondary-color);
        }

        .welcome-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .welcome-header h1 {
            color: var(--text-color);
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .email-info {
            color: #888;
            font-size: 0.9rem;
        }

        .email-info a {
            color: var(--primary-color);
            text-decoration: none;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 16px;
            padding: 1.75rem;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
            border: 1px solid var(--secondary-color);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .card-title {
            color: var(--text-color);
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-icon {
            width: 24px;
            height: 24px;
            color: var(--primary-color);
        }

        /* Package Status */
        .package-status {
            background: var(--light-bg);
            border: 1px solid var(--primary-color);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .package-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .package-row:last-child {
            border-bottom: none;
        }

        .package-label {
            color: #666;
        }

        .package-value {
            color: var(--text-color);
            font-weight: 600;
        }

        .discount-badge {
            background: var(--secondary-color);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
            margin-left: 0.5rem;
        }

        .payment-progress {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .progress-bar {
            background: var(--border-color);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            height: 100%;
            width: 30%;
            transition: width 0.3s ease;
        }

        .refund-note {
            color: #888;
            font-size: 0.85rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        /* Sessions Available */
        .session-item {
            margin-bottom: 1.25rem;
        }

        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .session-type {
            color: var(--text-color);
            font-weight: 600;
        }

        .session-count {
            color: #666;
            font-size: 0.9rem;
        }

        .session-bar {
            background: var(--border-color);
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .session-bar-fill {
            background: var(--primary-color);
            height: 100%;
            transition: width 0.3s ease;
        }

        .book-btn {
            background: var(--primary-color);
            color: white;
            padding: 0.4rem 1rem;
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.9rem;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .book-btn:hover {
            background: var(--text-color);
        }

        .add-sessions-btn {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            display: block;
            text-align: center;
            margin-top: 1.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .add-sessions-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(101, 151, 184, 0.4);
        }

        /* Minutes Bank */
        .minutes-bank {
            background: var(--light-bg);
            border: 2px solid var(--secondary-color);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }

        .minutes-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 0.5rem 0;
        }

        .minutes-description {
            color: #666;
            font-size: 0.9rem;
        }

        /* Session History */
        .history-list {
            max-height: 250px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: var(--light-bg);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .history-date {
            color: #888;
            font-size: 0.9rem;
        }

        .history-type {
            color: var(--text-color);
            font-weight: 500;
        }

        .history-status {
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .status-complete {
            background: var(--light-bg);
            color: var(--secondary-color);
            font-weight: 600;
            border: 1px solid var(--secondary-color);
        }

        .status-banked {
            background: var(--light-bg);
            color: var(--primary-color);
            font-weight: 600;
            border: 1px solid var(--primary-color);
        }

        /* Upcoming Sessions */
        .upcoming-item {
            background: var(--light-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .upcoming-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.5rem;
        }

        .upcoming-date {
            color: var(--text-color);
            font-weight: 600;
        }

        .upcoming-time {
            color: #666;
            font-size: 0.9rem;
        }

        .reschedule-btn {
            background: white;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: 0.3rem 0.8rem;
            border-radius: 4px;
            text-decoration: none;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .reschedule-btn:hover {
            background: var(--primary-color);
            color: white;
        }


        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .welcome-header {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-links {
                display: none;
            }

            .mobile-menu-btn {
                display: flex;
            }
        }
    </style>
</head>
<body>
    <!-- Loading State -->
    <div id="loading" class="loading">
        Loading your dashboard...
    </div>

    <!-- Login Form -->
    <div id="loginForm" class="login-form hidden">
        <h2 style="text-align: center; margin-bottom: 2rem; color: var(--text-color);">Client Portal</h2>
        <div id="demo-notice" style="background: var(--light-bg); border: 1px solid var(--primary-color); border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem; text-align: center; color: var(--text-color); font-size: 0.9rem;">
            <strong>Demo Mode:</strong> Enter any email and password to explore the client portal
        </div>
        <div id="error" class="error-message hidden"></div>
        <form id="authForm">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" id="email" class="form-input" required placeholder="demo@example.com">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" id="password" class="form-input" required placeholder="demo123">
            </div>
            <button type="submit" class="form-button">Sign In</button>
        </form>
        <p style="text-align: center; margin-top: 1rem; color: #666;">
            Don't have an account? <a href="mailto:hello@innercompassparenting.com" style="color: var(--primary-color);">Contact us</a>
        </p>
    </div>

    <!-- Dashboard Content -->
    <div id="dashboard" class="hidden">
    <!-- Header -->
    <header>
        <div class="container">
            <nav class="header-content">
                <div class="logo">
                    <a href="index.html"><img src="./logo.svg" alt="Inner Compass Parenting"></a>
                </div>
                <ul class="nav-links">
                    <li><a href="index.html#about">Our Story</a></li>
                    <li><a href="index.html#sessions">What to Expect</a></li>
                    <li><a href="booking_choice.html">Sessions & Packages</a></li>
                    <li><a href="index.html#contact">Contact</a></li>
                    <li><a href="#" class="logout-btn">Log Out</a></li>
                </ul>
                <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
            </nav>
        </div>
    </header>

    <!-- Mobile Navigation Menu -->
    <div class="mobile-nav" id="mobileNav">
        <ul class="mobile-nav-links">
            <li><a href="index.html#about" onclick="closeMobileMenu()">Our Story</a></li>
            <li><a href="index.html#sessions" onclick="closeMobileMenu()">What to Expect</a></li>
            <li><a href="booking_choice.html" onclick="closeMobileMenu()">Sessions & Packages</a></li>
            <li><a href="index.html#contact" onclick="closeMobileMenu()">Contact</a></li>
            <li><a href="#" onclick="closeMobileMenu()">Log Out</a></li>
        </ul>
    </div>

    <!-- Welcome Section -->
    <div class="container">
        <div class="welcome-section">
            <div class="welcome-header">
                <div>
                    <h1>Welcome back, Sarah!</h1>
                    <div class="email-info">
                        Account: sarah@email.com • 
                        <a href="#">Reset Password</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Package Overview -->
            <div class="card">
                <h2 class="card-title">
                    <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                        <path d="M3 9h18M9 21V9"/>
                    </svg>
                    Your Package
                </h2>
                <div class="package-status">
                    <div class="package-row">
                        <span class="package-label">Total Package</span>
                        <span class="package-value">
                            $850
                            <span class="discount-badge">15% saved</span>
                        </span>
                    </div>
                    <div class="package-row">
                        <span class="package-label">Payment Plan</span>
                        <span class="package-value">$85/week × 10 weeks</span>
                    </div>
                    <div class="payment-progress">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span class="package-label">Payment Progress</span>
                            <span class="package-value">Week 3 of 10</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill"></div>
                        </div>
                    </div>
                </div>
                <div class="refund-note">
                    For refunds or concerns about any session, email hello@innercompassparenting.com
                </div>
            </div>

            <!-- Sessions Available -->
            <div class="card">
                <h2 class="card-title">
                    <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 6v6l4 2"/>
                    </svg>
                    Sessions Available
                </h2>
                
                <div class="session-item">
                    <div class="session-header">
                        <span class="session-type">Virtual 30min</span>
                        <span class="session-count">3 of 5 remaining</span>
                    </div>
                    <div class="session-bar">
                        <div class="session-bar-fill" style="width: 60%;"></div>
                    </div>
                    <a href="#" class="book-btn">Book Now</a>
                </div>

                <div class="session-item">
                    <div class="session-header">
                        <span class="session-type">Virtual 1hr</span>
                        <span class="session-count">2 of 8 remaining</span>
                    </div>
                    <div class="session-bar">
                        <div class="session-bar-fill" style="width: 25%;"></div>
                    </div>
                    <a href="#" class="book-btn">Book Now</a>
                </div>

                <div class="session-item">
                    <div class="session-header">
                        <span class="session-type">In-Person 2hr</span>
                        <span class="session-count">1 of 2 remaining</span>
                    </div>
                    <div class="session-bar">
                        <div class="session-bar-fill" style="width: 50%;"></div>
                    </div>
                    <a href="#" class="book-btn">Book Now</a>
                </div>

                <a href="custom_package.html" class="add-sessions-btn">+ Add More Sessions</a>
            </div>

            <!-- Minutes Bank -->
            <div class="card">
                <h2 class="card-title">
                    <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 6v6h4.5"/>
                    </svg>
                    Minutes Bank
                </h2>
                <div class="minutes-bank">
                    <div class="minutes-number">45</div>
                    <div>minutes available</div>
                    <div class="minutes-description">
                        When sessions end early, unused time carries forward for future use
                    </div>
                </div>
            </div>

            <!-- Session History -->
            <div class="card">
                <h2 class="card-title">
                    <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2v20M2 12h20"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                    Session History
                </h2>
                <div class="history-list">
                    <div class="history-item">
                        <div>
                            <div class="history-date">Aug 11, 2024</div>
                            <div class="history-type">Virtual 30min</div>
                        </div>
                        <span class="history-status status-complete">✓ Complete</span>
                    </div>
                    <div class="history-item">
                        <div>
                            <div class="history-date">Aug 1, 2024</div>
                            <div class="history-type">In-Person 1hr</div>
                        </div>
                        <span class="history-status status-banked">+15 min banked</span>
                    </div>
                    <div class="history-item">
                        <div>
                            <div class="history-date">Jul 20, 2024</div>
                            <div class="history-type">In-Person 2hr</div>
                        </div>
                        <span class="history-status status-complete">✓ Complete</span>
                    </div>
                    <div class="history-item">
                        <div>
                            <div class="history-date">Jul 10, 2024</div>
                            <div class="history-type">Virtual 1hr</div>
                        </div>
                        <span class="history-status status-complete">✓ Complete</span>
                    </div>
                </div>
            </div>

            <!-- Upcoming Sessions -->
            <div class="card">
                <h2 class="card-title">
                    <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    Upcoming Sessions
                </h2>
                
                <div class="upcoming-item">
                    <div class="upcoming-header">
                        <div>
                            <div class="upcoming-date">August 19, 2024</div>
                            <div class="upcoming-time">Virtual 30min @ 2:00 PM</div>
                        </div>
                        <a href="#" class="reschedule-btn">Reschedule</a>
                    </div>
                </div>

                <div class="upcoming-item">
                    <div class="upcoming-header">
                        <div>
                            <div class="upcoming-date">August 26, 2024</div>
                            <div class="upcoming-time">In-Person 2hr @ 10:00 AM</div>
                        </div>
                        <a href="#" class="reschedule-btn">Reschedule</a>
                    </div>
                </div>
            </div>
        </div>

    </div>
    </div> <!-- Close dashboard div -->

    <script>
        // Supabase configuration
        const SUPABASE_URL = 'YOUR_SUPABASE_URL_HERE';
        const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY_HERE';
        
        // Initialize Supabase only if credentials are provided
        let supabase = null;
        if (SUPABASE_ANON_KEY !== 'YOUR_SUPABASE_ANON_KEY_HERE' && window.supabase) {
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        }

        // Authentication functionality
        async function checkAuth() {
            const loading = document.getElementById('loading');
            const loginForm = document.getElementById('loginForm');
            const dashboard = document.getElementById('dashboard');

            try {
                // If Supabase is not configured, show login form for demo purposes
                if (!supabase || SUPABASE_ANON_KEY === 'YOUR_SUPABASE_ANON_KEY_HERE') {
                    console.log('Supabase not configured - showing login form');
                    loading.classList.add('hidden');
                    loginForm.classList.remove('hidden');
                    return;
                }

                const { data: { session } } = await supabase.auth.getSession();
                
                if (session) {
                    await loadDashboard(session.user);
                    loading.classList.add('hidden');
                    dashboard.classList.remove('hidden');
                } else {
                    loading.classList.add('hidden');
                    loginForm.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                // Show login form on error
                loading.classList.add('hidden');
                loginForm.classList.remove('hidden');
            }
        }

        async function signIn(email, password) {
            const errorDiv = document.getElementById('error');
            
            try {
                // If Supabase is not configured, use demo login
                if (!supabase || SUPABASE_ANON_KEY === 'YOUR_SUPABASE_ANON_KEY_HERE') {
                    console.log('Demo login - using mock data');
                    // Simple demo login - accept any email/password for now
                    const mockUser = {
                        email: email,
                        user_metadata: {
                            first_name: email.split('@')[0]
                        }
                    };
                    
                    await loadDashboard(mockUser);
                    document.getElementById('loginForm').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    return;
                }

                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) throw error;

                await loadDashboard(data.user);
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                
            } catch (error) {
                console.error('Sign in failed:', error);
                errorDiv.textContent = error.message || 'Login failed. Please try again.';
                errorDiv.classList.remove('hidden');
            }
        }

        async function signOut() {
            try {
                if (supabase) {
                    const { error } = await supabase.auth.signOut();
                    if (error) throw error;
                }
                
                document.getElementById('dashboard').classList.add('hidden');
                document.getElementById('loginForm').classList.remove('hidden');
                document.getElementById('error').classList.add('hidden');
                document.getElementById('authForm').reset();
                
            } catch (error) {
                console.error('Sign out failed:', error);
            }
        }

        async function loadDashboard(user) {
            try {
                // Update user name in welcome section
                const welcomeH1 = document.querySelector('.welcome-header h1');
                const emailInfo = document.querySelector('.email-info');
                
                welcomeH1.textContent = `Welcome back, ${user.user_metadata?.first_name || user.email.split('@')[0]}!`;
                emailInfo.innerHTML = `Account: ${user.email} • <a href="#" onclick="signOut()">Sign Out</a>`;

                // Load client data from Supabase if configured, otherwise use mock data
                if (supabase && SUPABASE_ANON_KEY !== 'YOUR_SUPABASE_ANON_KEY_HERE') {
                    await loadClientData(user.id || 'demo-user');
                } else {
                    console.log('Using mock dashboard data');
                    loadMockDashboard();
                }
                
            } catch (error) {
                console.error('Failed to load dashboard:', error);
                loadMockDashboard();
            }
        }

        async function loadClientData(userId) {
            try {
                // Fetch client session data
                const { data: sessions, error: sessionsError } = await supabase
                    .from('client_sessions')
                    .select('*')
                    .eq('user_id', userId);

                if (sessionsError) throw sessionsError;

                // Fetch payment data
                const { data: payments, error: paymentsError } = await supabase
                    .from('client_payments')
                    .select('*')
                    .eq('user_id', userId);

                if (paymentsError) throw paymentsError;

                // Update dashboard with real data
                updateSessionsDisplay(sessions);
                updatePaymentDisplay(payments[0]); // Assuming one active package per client

            } catch (error) {
                console.error('Failed to load client data:', error);
                // Fall back to mock data
                loadMockDashboard();
            }
        }

        function updateSessionsDisplay(sessions) {
            // Update session availability bars and counts
            const sessionItems = document.querySelectorAll('.session-item');
            
            // Group sessions by type
            const sessionCounts = {
                'virtual30': { used: 0, total: 0 },
                'virtual60': { used: 0, total: 0 },
                'inperson120': { used: 0, total: 0 }
            };

            sessions.forEach(session => {
                const type = session.session_type;
                sessionCounts[type].total++;
                if (session.status === 'completed' || session.status === 'booked') {
                    sessionCounts[type].used++;
                }
            });

            // Update each session item
            sessionItems.forEach((item, index) => {
                const types = ['virtual30', 'virtual60', 'inperson120'];
                const type = types[index];
                const counts = sessionCounts[type];
                
                const remaining = counts.total - counts.used;
                const percentage = counts.total > 0 ? (counts.used / counts.total) * 100 : 0;
                
                item.querySelector('.session-count').textContent = `${remaining} of ${counts.total} remaining`;
                item.querySelector('.session-bar-fill').style.width = `${percentage}%`;
            });
        }

        function updatePaymentDisplay(payment) {
            if (!payment) return;
            
            // Update package overview
            const packageRows = document.querySelectorAll('.package-row .package-value');
            packageRows[0].innerHTML = `$${payment.total_amount}<span class="discount-badge">${payment.discount_percent}% saved</span>`;
            
            if (payment.payment_plan_type === 'weekly') {
                packageRows[1].textContent = `$${payment.weekly_amount}/week × ${payment.total_weeks} weeks`;
                
                // Update progress
                const progressText = document.querySelector('.payment-progress .package-value');
                progressText.textContent = `Week ${payment.current_week} of ${payment.total_weeks}`;
                
                const progressBar = document.querySelector('.progress-fill');
                const progressPercent = (payment.current_week / payment.total_weeks) * 100;
                progressBar.style.width = `${progressPercent}%`;
            }
        }

        function loadMockDashboard() {
            // Use the existing mock data when Supabase is not available
            console.log('Loading mock dashboard data');
            
            // The static HTML already contains mock data, so we don't need to do anything
            // This function is called when Supabase is not configured or fails
            
            // Optional: You can update specific elements here if needed
            // For now, the existing static content will be displayed
        }

        // Event listeners
        document.getElementById('authForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            await signIn(email, password);
        });

        // Update logout button functionality
        document.querySelector('.logout-btn').addEventListener('click', (e) => {
            e.preventDefault();
            signOut();
        });

        // Initialize authentication check on page load
        document.addEventListener('DOMContentLoaded', checkAuth);

        // Add session booking functionality
        document.querySelectorAll('.book-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                // Redirect to booking page - you can customize this URL
                window.location.href = 'booking_single_session.html';
            });
        });

        // Add more sessions functionality
        document.querySelector('.add-sessions-btn').addEventListener('click', (e) => {
            e.preventDefault();
            window.location.href = 'booking_package.html';
        });

        // Mock data fallback - same as before
        
        // Mock data - CC will replace with Supabase integration
        const clientData = {
            name: 'Sarah',
            email: 'sarah@email.com',
            package: {
                total: 850,
                discount: 15,
                paymentPlan: {
                    amount: 85,
                    frequency: 'week',
                    total: 10,
                    current: 3
                }
            },
            sessions: {
                virtual30: { used: 2, total: 5 },
                virtual60: { used: 6, total: 8 },
                inperson120: { used: 1, total: 2 }
            },
            minutesBank: 45,
            history: [
                { date: 'Aug 11', type: 'Virtual 30min', status: 'complete' },
                { date: 'Aug 1', type: 'In-Person 1hr', status: 'banked', minutes: 15 },
                { date: 'Jul 20', type: 'In-Person 2hr', status: 'complete' }
            ],
            upcoming: [
                { date: 'Aug 19', type: 'Virtual 30min', time: '2:00 PM' },
                { date: 'Aug 26', type: 'In-Person 2hr', time: '10:00 AM' }
            ]
        };

        // Show/hide back to top button
        function toggleBackToTop() {
            const button = document.getElementById('backToTop');
            if (window.pageYOffset > 300) {
                button.style.display = 'flex';
            } else {
                button.style.display = 'none';
            }
        }

        // Scroll to top
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Event listener
        window.addEventListener('scroll', toggleBackToTop);

        // Mobile menu functions
        function toggleMobileMenu() {
            const mobileNav = document.getElementById('mobileNav');
            mobileNav.classList.toggle('active');
        }

        function closeMobileMenu() {
            const mobileNav = document.getElementById('mobileNav');
            mobileNav.classList.remove('active');
        }

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const mobileNav = document.getElementById('mobileNav');
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            
            if (!mobileNav.contains(event.target) && !mobileMenuBtn.contains(event.target)) {
                mobileNav.classList.remove('active');
            }
        });
    </script>

    <!-- Back to Top Button -->
    <button id="backToTop" onclick="scrollToTop()" style="
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        cursor: pointer;
        box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        display: none;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        transition: all 0.3s ease;
        z-index: 1000;
    ">↑</button>
</body>
</html>